<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Panditan Di Hatti</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="/images/LOGO.png" />
  
  <!-- GoatCounter Analytics -->
  <script data-goatcounter="https://harshit.goatcounter.com/count"
          async src="//gc.zgo.at/count.js"></script>

  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; }
    header, footer { background: #f1a208; color: white; padding: 10px 20px; text-align: center; }
    section { padding: 20px; }
    .menu-item, .review, .offer { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
    img { max-width: 100%; height: auto; }
  </style>
</head>

<body>
  <header>
    <img id="logo" src="/images/LOGO.png" alt="Logo" height="60" />
    <h1 id="site-title">Panditan Di Hatti</h1>
    <p id="tagline">Where tradition meets taste</p>
    <p id="timings">Loading...</p>
  </header>

  <section id="banner">
    <h2 id="banner-text">Loading Banner...</h2>
    <img id="banner-image" src="/images/banner.jpg" alt="Banner" />
  </section>

  <section id="about">
    <h2>About Us</h2>
    <p id="about-text">Loading about us...</p>
    <img id="owner-image" src="/images/OWNER.png" alt="Owner" />
  </section>

  <section id="offers">
    <h2>Special Offers</h2>
    <div id="offers-list">Loading offers...</div>
  </section>

  <section id="menu">
    <h2>Our Menu</h2>
    <div id="menu-items">Loading menu...</div>
  </section>

  <section id="reviews">
    <h2>Customer Reviews</h2>
    <div id="reviews-list">Loading reviews...</div>
  </section>

  <section id="video">
    <h2>Our Inspiration</h2>
    <video controls width="320">
      <source id="pm-video" src="/PM.mp4" type="video/mp4">
    </video>
  </section>

  <footer>
    <p id="footer-text">© 2025 Panditan Di Hatti</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/showdown@2.1.0/dist/showdown.min.js"></script>
  <script>
    // Load YAML file
    async function loadYAML(path) {
      const res = await fetch(path);
      const text = await res.text();
      return jsyaml.load(text);
    }

    // Load Markdown content
    async function loadMarkdownFolder(folder, callback) {
      const res = await fetch(folder);
      const html = await res.text();
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');
      const links = Array.from(doc.querySelectorAll('a')).map(a => a.getAttribute('href')).filter(h => h.endsWith('.md'));
      const converter = new showdown.Converter();

      for (let file of links) {
        const fileRes = await fetch(`${folder}${file}`);
        const content = await fileRes.text();
        const match = content.match(/---([\s\S]*?)---([\s\S]*)/);
        if (!match) continue;
        const front = jsyaml.load(match[1]);
        const body = converter.makeHtml(match[2]);
        callback(front, body);
      }
    }

    async function init() {
      // Load settings
      const settings = await loadYAML('/settings.yml');
      document.getElementById('site-title').textContent = settings.title;
      document.getElementById('tagline').textContent = settings.tagline;
      document.getElementById('timings').textContent = settings.timings;
      document.getElementById('footer-text').textContent = settings.footer;
      document.getElementById('logo').src = settings.logo;
      document.getElementById('pm-video').src = settings.pm_video;

      // Load banner
      const banner = await loadYAML('/banner.yml');
      document.getElementById('banner-text').textContent = banner.text || 'Our Specials';
      if (banner.image) document.getElementById('banner-image').src = banner.image;

      // Load about
      const about = await loadYAML('/about.yml');
      document.getElementById('about-text').textContent = about.body;
      document.getElementById('owner-image').src = settings.owner;

      // Load offers
      const offersList = document.getElementById('offers-list');
      await loadMarkdownFolder('/content/offers/', (front, body) => {
        const div = document.createElement('div');
        div.className = 'offer';
        div.innerHTML = `<h4>${front.title || ''}</h4><p>${body}</p>`;
        offersList.appendChild(div);
      });

      // Load menu items
      const menu = document.getElementById('menu-items');
      await loadMarkdownFolder('/content/menu/', (front) => {
        const div = document.createElement('div');
        div.className = 'menu-item';
        div.innerHTML = `<strong>${front.title}</strong> - ₹${front.price}<br><img src="${front.image}" alt="" width="150" />`;
        menu.appendChild(div);
      });

      // Load reviews
      const reviews = document.getElementById('reviews-list');
      await loadMarkdownFolder('/content/reviews/', (front) => {
        const div = document.createElement('div');
        div.className = 'review';
        div.innerHTML = `<strong>${front.name} says:</strong><p>${front.body}</p>`;
        reviews.appendChild(div);
      });
    }

    init();
  </script>
</body>
</html>
